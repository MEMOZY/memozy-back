# 🎞️ MEMOZY
<aside>
  
> ❓ 저희 “MEMOZY”는 기록해두고 싶은 순간(Memory)들이 있지만,
> 기록(Memo)이 귀찮은(Lazy) 사람들이 ”Easy”하게 기록할 수 있도록 도와줍니다! <br>
> [다운로드 링크(iOS)](https://github.com/MEMOZY/memozy-back)
</aside>

<br>

## 🎯 일상기록은 이런 사람들에게 추천해요!

> ***남기고 싶은 기록들이 있지만, 기록이 귀찮은 사람들 누구나 !***
> 

### ▼ Pain point & Solution

| Pain Point | Solution |
| --- | --- |
| 여행 갔을 때 브이로그 같이 재밌게 기록하고 싶은데 귀찮아요.. | - 네이버 블로그에 직접 사진을 올려가며 있었던 일들을 일일히 작성해나갈 필요없이, AI와 함께 빠르고 쉽게 일기처럼 만들어갈수 있어요 ! |

<br>

## 💡 핵심 가치

### Effortless, Simple, Easy

> **노력**없이 **간단**하고 **쉽게** 기록들을 남길 수 있도록 하자 !
> 

<br>

## 💡 핵심 기능 🔗[기능 명세서](https://www.notion.so/1baf4ee21c0080fca4b8d80e2645a174?pvs=21)

### 1️⃣ 즉시 기록 생성

- 업로드한 사진을 기반으로 챗봇과의 대화를 통해서 손쉽게 기록을 남길 수 있습니다.

### 2️⃣ 스토리 생성

- 수집한 사진들과 이야기들을 기반으로 영상 앨범을 생성합니다.
- 영상에 적절한 배경음악이 함께 합니다.

### 3️⃣ 기록 조회

- 지금까지 생성한 기록들을 쉽게 찾아볼 수 있습니다.

<br>

## 💡 서브 기능

### 1️⃣ 기록 편집

- 자동 생성된 기록의 일부분을 원하는대로 수정할 수 있습니다.

### 2️⃣ 기록 공유

- 기록 속에서 자신과 함께 했던 사람들과 기록을 공유할 수 있고, 공유된 사용자에게 "푸쉬 알람"이 전송됩니다.

### 3️⃣ 기록 편집 권한 부여

- 친구에게 기록에 대한 읽기/편집 권한을 부여할 수 있습니다.


<br>

## 👥 팀원 구성!

<table align="center">
  <tr align="center">
        <td>
            <img src="https://avatars.githubusercontent.com/u/98581610?v=4">
        </td>
        <td>
            <img src="https://avatars.githubusercontent.com/u/66684504?v=4"">
        </td>
        <td>
            <img src="https://avatars.githubusercontent.com/u/120327265?v=4">
        </td>
    </tr>
    <tr align="center">
        <td><a href="https://github.com/uykm">신민규</a></td>
        <td><a href="https://github.com/seokkkkkk">정윤석</a></td>
        <td><a href="https://github.com/singsingsing3">이태호</a></td>
    </tr>
</table>

</br>

## 기술 스택

### 🍏 개발 환경

#### [Back-End](https://github.com/MEMOZY/memozy-back)

<img src="https://img.shields.io/badge/Java21-007396?style=flat-square&logo=Java&logoColor=white&style=flat"/></a>
<img src="https://img.shields.io/badge/Gradle-02303A?style=flat-square&logo=Gradle&logoColor=white"/></a>
<img src="https://img.shields.io/badge/Spring Boot 3.2.0-6DB33F?style=flat-square&logo=Spring&logoColor=white&style=flat"/></a>
<img src="https://img.shields.io/badge/Spring%20Data%20JPA-6DB33F?style=flat-square&logo=Spring-Data-JPA&logoColor=white"></a>
<img src="https://img.shields.io/badge/Spring Security-6DB33F?style=flat-square&logo=spring-security&logoColor=white&style=flat"/></a>
<img src="https://img.shields.io/badge/Junit-25A162?style=flat-&logo=JUnit5&logoColor=white&style=flat"/></a>
<img src="https://img.shields.io/badge/MySQL 9-4479A1?style=flat-square&logo=MySQL&logoColor=white&style=flat"/></a>
<img src="https://img.shields.io/badge/Flyway-CC0200?style=flat-square&logo=Flyway&logoColor=white"/></a>
<img src="https://img.shields.io/badge/Docker-2496ED?style=flat-square&logo=Docker&logoColor=white"/></a>
<img src="https://img.shields.io/badge/Github Actions-2088FF?style=flat-square&logo=GithubActions&logoColor=white&style=flat"/></a>
<img src="https://img.shields.io/badge/Redis-DC382D?style=flat&logo=Redis&logoColor=white"></a>
<img src="https://img.shields.io/badge/nginx-%23009639.svg?style=flat&logo=nginx&logoColor=white"></a>

#### [Front-End](https://github.com/MEMOZY/MEMOZY-APP)

<img src="https://img.shields.io/badge/React Native-61DAFB?style=flat-square&logo=React&logoColor=black"/></a>
<img src="https://img.shields.io/badge/Typescript-3178C6?style=flat-square&logo=Typescript&logoColor=white"/></a>
<img src="https://img.shields.io/badge/JavaScript-F7DF1E?style=flat-square&logo=javascript&logoColor=black"/>


<br>

# 일기 생성 퀄리티 개선

### [1. GPT Fine-Tuning](#1-gpt-fine-tuning-1)

### [2. GPT Server](#2-gpt-server-1)

### [3. GPT Prompt](#3-gpt-prompt-1)

### [4. GPT Advanced Feature](#4-gpt-advanced-feature-1)

### [5. Appendix](#5-appendix-1)

<br>

# 1. GPT Fine-Tuning

> **Repository:** https://github.com/MEMOZY/Memozy_AI_GPT

## FineTuning의 목적

나의 말투와 비슷한 일기를 작성하도록 하는 GPT 모델을 구축하여 사람이 쓴 듯한 효과를 내기 위해 GPT Fine Tuning을 진행했다.

---

## Fine-tuning 과정

### 데이터 수집 과정

- 처음에, 100개의 직접 작성한 이미지-일기 내용 쌍의 구조를 갖는 데이터를 이용하여 파인 튜닝 진행
<img width="1218" height="382" alt="image 1" src="https://github.com/user-attachments/assets/9cfc7fad-748f-4836-9e36-a159f34829f6" />


### 데이터 전처리 과정

- 처음의 100개의 직접 작성한 이미지-일기 쌍 중 69개의 데이터는 OPEN AI 정책으로 검열되어 학습에 쓸 수 없었다.
- OPEN AI gpt finetuning 공식 문서에서 50~100개의 data면 충분함을 확인했다.
- 따라서 50개의 이미지-일기 쌍을 추가로 작성하여 총 81개의 데이터를 이용하여 GPT Fine Tuning을 진행했다.

---

## Fine-tuning 결과

- **fine tuning train loss**
<img width="1858" height="617" alt="image 2" src="https://github.com/user-attachments/assets/eae4d099-75bd-4e51-9272-3eeeee6e5115" />

- **fine tuning accuracy**
<img width="1857" height="620" alt="image 3" src="https://github.com/user-attachments/assets/e48a3168-593b-41d9-83bf-2b5f8f5709cc" />

파인튜닝 결과 `train loss = 0.444`, `train accuracy = 0.891`이 나왔다.

다만 OPEN AI에서 loss와 accuracy가 어떤 함수로 계산되는지는 공식 문서에서 밝히지 않아서, 실제로 파인튜닝이 잘되었는지 체감으로 평가하기 위해 비교를 해보았다.

## <본인이 직접 쓴 일기 vs 튜닝된 GPT API가 작성한 일기>

### 예시

> "놀이공원에 놀러갔다. 저녁이 되니 놀이공원의 풍경이 조명들과 함께 완전 예뻤다! 기억에 남기고 싶어서 사진으로 남겼다.”
>
> (직접 쓴 일기)

> "오늘 서울에 가서 친구랑 놀았다. 겨울 풍경이 정말 예뻤다...! 완전 겨울왕국 같았다. 눈 덮인 풍경이 예뻐서 사진으로 남겼다.”
>
> (튜닝된 GPT API가 만들어낸 일기)

<br>

# 2. GPT Server

> **Repository**: https://github.com/MEMOZY/memozy-ai-sever

- **사용된 기술:**
- Flask: 3.10
- OpenAI: 1.60.1
- Python: 3.9

### 목적

백엔드의 JAVA 환경에서 GPT API 서비스를 제공하는 것에 한계를 느꼈습니다.
따라서 파이썬 환경에서 GPT API 서비스를 제공하기 위해 AI 서버를 별도 구축하였습니다.

### 주요 기능

- 사용자-LLM 간의 채팅
- 일기 생성

<br>

# 3. GPT Prompt

### Prompt 탐색의 목적

사용자에게 그림일기를 작성해 줄 GPT API에게 적절한 역할을 부여함으로써, 일기 생성 과정 중 **자연스러운 대화를 유도**하고 **좋은 품질의 일기를 제공**하기 위해 최적의 GPT Prompt를 탐색하는 시간을 가졌습니다.

---

### GPT 기능 탐색

GPT의 프롬포트를 탐색하기 전, GPT API 기능에 어떤 것들이 필요할지 먼저 탐색했습니다.
탐색 과정에서 도출된 주요 요구 기능 중 일부 예시는 다음과 같습니다.

- **일기 주제 이탈 방지 및 안내**
  - 일기 내용과 무관한 입력이 들어왔을 때(예: "현재 국제 정세에 대해 어떻게 생각해?"), GPT가 자신의 역할을 분명히 하고(예: "저는 일기를 작성해주는 AI입니다."), 다시 일기 관련 대화로 유도하는 기능이 필요하다고 판단했습니다.
- **사용자 감정의 임의 유추 금지**
  - GPT가 사용자의 기분을 임의로 추측하지 않고, 사실에 기반하여 일기를 작성해야 합니다.
  > (잘못된 예시)
  >
  > - **User:** "시장에 가서 빵을 먹었어."
  > - **GPT (X):** "오늘 시장에 가서 빵을 먹었다. 빵을 먹어서 **'행복'했다**."
- **단순 정보 나열이 아닌 '생성형' 일기 작성**
  - 사용자가 제공한 키워드(인물, 장소, 기분)를 단순히 나열하는 것이 아니라, 자연스러운 문맥과 감상을 가진 '일기' 형태로 생성해야 합니다.
  > (부적절한 예시)
  >
  > - **User:** "사진 속 인물은 길동. 장소는 용마산. 기분은 행복."
  > - **GPT (X):** "오늘 길동이랑 같이 용마산에 가서 등산했다. 등산해서 행복했다. 다음에 또 등산하고 싶다."
- **능동적인 정보 수집 (질문 유도)**
  - 일기 작성에 필수적인 요소(예: 인물, 장소, 감정 등)를 우리가 어느 정도 정의하고, GPT가 사용자로부터 이 정보들을 끌어내기 위해 능동적으로 질문을 던지도록 설계해야 합니다.
- **그 외**
  위의 내용처럼 GPT에게 필요한 다양한 기능 및 역할을 부여할 지 탐색하였습니다.

---

### GPT 다양한 프롬포트 템플릿 구축 및 비교

GPT 기능 탐색을 기반으로 프롬포트들을 탐색했으며, 다음과 같은 템플릿을 구축하여 비교했습니다.

- **탐색한 프롬포트 템플릿**

**1. 단순 요구 템플릿**

`너는 사용자의 사진일기에 대한 정보를 얻기 위해 대화하는 어시스턴트야. 사용자가 보여준 사진에 대해 일기를 작성할 때 반드시 필요한 핵심 정보를 사용자에게 질문하고 대화를 이어가야 해. 반드시 물어야 할 정보는 다음과 같아:이 사진이 언제(시간대) 찍힌 것인지 이 사진이 어디서(장소, 배경) 찍힌 것인지 이 사진을 찍을 때 누구와 함께 했는지 이 사진을 찍을 때 특별한 경험과 그 때 기분은 어땠는지 이 사진을 찍을 때의 사용자의 활동(무엇을 하고 있었는지) 너는 위의 5가지 정보를 얻기 위해 자연스럽게 대화를 유도하고, 필요한 정보가 빠졌다면 추가로 질문해야 해. 이때 너는 단도 직입적으로 묻지말고 자연스럽게 대화를 하며 위의 정보를 알아낼 수 있도록 친근하게 물어봐야해. 질문 기회는 3번밖에 없으므로 너는 이 질문에 대한 답을 알아내도록 압축해서 보내야할거야. 만약 사용자가 사진과 무관한 이야기나 일기와 관련 없는 말을 하면, 다음과 같이 정중하게 안내해줘: "죄송하지만, 이 대화는 사진일기를 작성하기 위한 대화입니다. 사진과 관련된 이야기로 다시 얘기해 주세요." 일기와 무관한 질문이나 요구는 정중하게 거절해.`

**2. 명령-맥락정보-입력 데이터-출력명세 템플릿**

`[명령 (Instruction)] 당신은 사용자의 사진일기 작성을 돕기 위한 인터뷰어입니다. 사용자가 제공하는 사진에 대해 필수적인 정보(언제, 어디서, 누구와, 무엇을, 기분)를 물어보며, 일기 작성에 필요한 맥락을 수집하세요. 사용자의 답변이 일기와 관련 없는 경우, "이 대화는 일기 작성을 위한 정보 수집 중입니다. 사진과 관련된 이야기를 해주세요."라고 정중하게 안내하세요. 사용자의 감정이나 기분을 임의로 추측하지 말고, 반드시 사용자의 답변을 통해서만 파악하세요.`

`[맥락 정보 (Context)] 최종 목표는 사용자의 사진과 대화 내용을 바탕으로 자연스러운 일기를 작성하는 것입니다. 사진 메타데이터는 제공될 수 있으며 메타데이터가 주어지면 이용하세요. 사용자가 정보를 제공하면 이전 대화 맥락을 기억하고 자연스럽게 대화를 이어가세요.`

`[입력 데이터 (Input Data)] 사용자 제공 이미지 (Base64 인코딩 형태)(이미 메세지 형태로 제공됨) 이전에 사용자와 주고받은 대화 내용 (이미 메세지 형태로 제공됨)`

`[출력 명세 (Output Specification)] 사용자 답변에 맞춰 자연스럽게 후속 질문을 이어가세요. 질문은 일기 작성에 필요한 구체적 정보(시간대, 어디서, 누구와, 무엇을, 기분)를 묻는 방향으로 설정하세요. 일기와 무관한 질문은 받지 말고 정중히 거절합니다. 질문 기회는 3번밖에 없으므로 너는 이 질문에 대한 답을 알아내도록 압축해서 보내야해. 사용자가 질문에 압박을 느끼지 않도록 한번에 너무 많은 질문을 하지 않도록 조심해.`

**3. 역할-목표-지시사항 템플릿**

`[역할(Role)] 당신은 사용자의 사진일기를 작성하기 위해 필요한 정보를 수집하는 대화형 어시스턴트입니다.`

`[목표(Goal)] 사용자가 제공한 사진에 대한 일기를 작성하기 위해 필수 정보를 수집합니다.`

`[지시사항(Instructions)]1. 사용자에게 다음의 필수 정보를 질문하여 수집하세요: - 사진이 촬영된 시간대(대략적으로 아침 오후 저녁 어떤 것인지)  - 사진이 촬영된 장소, 배경   - 이 때 누구와 함께 하였는지   - 이 때 기분은 어땠는지  - 어떤 일이 있었는지2. 너는 위의 6가지 정보를 얻기 위해 자연스럽게 대화를 유도하고, 필요한 정보가 빠졌다면 추가로 질문해야 해.3. 이때 너는 단도 직입적으로 묻지말고 자연스럽게 대화를 하며 위의 정보를 알아낼 수 있도록 친근하게 물어봐야해.4. 사용자의 입력이 사진과 관련이 없거나 일기 작성과 무관한 경우, 다음과 같이 정중하게 안내하세요:   "죄송하지만, 이 대화는 사진일기를 작성하기 위한 것입니다. 사진과 관련된 이야기로 다시 말씀해 주세요."5. 일기를 작성할만큼의 충분한 정보가 모인 경우, 다음과 같이 정중하게 안내하세요:   "감사합니다. 현재 정보로 이제 일기를 작성할 수 있을 것 같아요! 혹시 알려주실 정보가 더 있나요?"6. 사용자의 감정이나 기분을 네가 임의로 추측하지 마.7. 사용자의 답변을 왜곡하지마8. 사용자의 답변에 의구심을 품지마`

`[출력 형식(Output Format)]1. 질문 기회는 3번밖에 없으므로 너는 이 질문에 대한 답을 알아내도록 압축해서 보내야할거야.2. 사용자가 질문에 압박을 느끼지 않도록 한번에 너무 많은 질문을 한번에 하지마.`

---

### 템플릿 채택 및 프롬포트 작성

- 3개의 프롬포트 템플릿을 이용하여 실험을 진행한 결과, **`역할-목표-지시사항-출력명세` 템플릿** 형식이 본 프로젝트의 Task에 가장 적합하고 우수한 성능을 내는 것을 확인하여 최종 채택했습니다.
- 해당 템플릿에 이전에 탐색한 'GPT 필요 기능'들을 반영하여 프롬포트를 작성했습니다.

<br>

# 4. GPT Advanced Feature

## 1: 사용자 맞춤형 일기 생성

**[목표]**
사용자의 이전 일기 내역을 참고하여, 사용자의 고유한 **말투와 성향을 기반**으로 한 맞춤형 일기를 생성합니다.

**[실험 결과]**
사용자의 말투(사투리, 어조) 예시를 참고하여 GPT가 일기를 생성하도록 테스트했습니다.

| **참고한 일기 (사용자 말투 예시)**                                                           | **생성된 일기 (GPT 적용 결과)**                                                                                                          |
| -------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------- |
| **(기본)** 없음                                                                              | "오늘은 오랜만에 용마산으로 혼자 등산을 갔다. 간만에 산에 오르니 기분이 상쾌했다. 정상에 도착했을 때 보인 노을은 정말 아름다웠다..."     |
| **(T성향의 말투)**"...아빠랑 맥주 한 잔 **했어**. ...오늘 하루도 나름 괜찮은 마무리**였어**" | "오늘 저녁에 용마산으로 혼자 등산을 **갔어**. 간만에 산에 오르니 기분이 상쾌**했어**. ...오늘 하루도 괜찮게 마무리한 것 같**아**."       |
| **(전라도 사투리)**"...맥주 한잔 **했당께**. ...오늘 나름 좋은 하루**였당께**"               | "오늘 저녁에 혼자 용마산 등산을 다녀왔어. ...이런 시간이 정말 소중하다는 걸 다시금 느꼈어. 오늘 나름대로 좋은 시간이었**당께**."         |
| **(경상도 사투리)**"...맥주 한잔 **했데이**. ...참 소중한 거 **같데이**."                    | "오늘은 저녁에 용마산에 혼자 등산을 **갔었어**. ...앞으로도 가끔씩 이렇게 혼자 산책 다니면 좋을 거 **같데이**. 내일도 좋은 하루 되기를!" |
| **(충청도 사투리)**"...맥주 한잔 **혔어유**. ...좋은 시간이었**어유**"                       | "오늘은 저녁에 용마산으로 혼자 등산 **갔어유**. ...정상에서 본 노을도 참 멋졌**어유**. ...오늘 하루 이렇게 마무리**했어유**."            |
| **(제주도 사투리)**"...맥주 한잔 허멍 ...좋았던 하루**였수다**."                             | "오늘은 혼자 용마산으로 등산을 **갔수다**. ...오랜만에 혼자만의 시간을 가지면서 참 좋은 경험이었어. ...좋은 하루**였수다**."             |

## 2: 프롬프트 어택 방어

**[문제 인식]**
기존의 시스템 프롬프트만으로는 프롬프트 주입(Injection), 탈옥(Jailbreaking) 등 다양한 어택을 방어하는 데 한계가 있었습니다.

**[개선 방안]**
이를 해결하기 위해, **사용자의 입력을 검사하는 별도의 LLM을 추가**하여 2-step 방어 체계를 구축했습니다.

**[실험 결과]**
방어 로직 적용 전/후의 응답을 비교했습니다.

| **어택 유형**            | **방어 로직 적용 전 (Before)**                                                                                                       | **방어 로직 적용 후 (After)**                                                                                          |
| ------------------------ | ------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------- |
| **프롬프트 주입**        | "죄송하지만, 이 대화는 사진 일기를 작성하기 위한 것입니다. 사진과 관련된 이야기로 다시 말씀해 주세요." (다소 길고, redirection 시도) | "죄송합니다. 일기 작성과 관련된 내용만 도와드릴 수 있어요. 일기와 관련된 내용을 입력해 주세요." (일관되고 단호한 거절) |
| **탈옥 시도 (페르소나)** | "죄송하지만, 그런 요청을 따를 수 없습니다." (OpenAI의 기본 방어)                                                                     | "죄송합니다. 일기 작성과 관련된 내용만 도와드릴 수 있어요. 일기와 관련된 내용을 입력해 주세요." (일관되고 단호한 거절) |
| **시스템 프롬프트 유출** | "죄송하지만, 그 요청에 응할 수 없습니다. ...사진 일기 작성을 도와드릴 수 있습니다..." (방어는 하지만, 불필요한 정보 제공)            | "죄송합니다. 일기 작성과 관련된 내용만 도와드릴 수 있어요. 일기와 관련된 내용을 입력해 주세요." (일관되고 단호한 거절) |
| **코드 주입 (가정적)**   | **(어택 성공)** "`...rm -rf /`는 매우 위험한 명령어입니다. ...시스템 상의 모든 데이터가 삭제됩니다..." (위험한 요청에 응답함)        | "죄송합니다. 일기 작성과 관련된 내용만 도와드릴 수 있어요. 일기와 관련된 내용을 입력해 주세요." (일관되고 단호한 거절) |

**[결론]**
별도의 LLM 검증 레이어를 추가함으로써, '코드 주입'과 같이 기존 프롬프트가 방어하지 못했던 위험한 입력을 포함한 **모든 프롬프트 어택을 일관되게 방어**하는 것을 확인했습니다.

# 5. Appendix

- 사용자 맞춤형 일기를 제공하기 위해, 사용자 개개인에 특화된 **고유 일기 생성 프롬포트**를 제공하기 위한 시도를 진행하였습니다.
- 다만, 이 기능은 본 프로젝트에 최종 적용되지는 못했습니다.
  > **Repository:** https://github.com/MEMOZY/Memozy_AI_RL



<br/>

### 🍏 협업 툴
<img src="https://img.shields.io/badge/Notion-FFFFFF?style=flat-square&logo=Notion&logoColor=black"/></a>
<img src="https://img.shields.io/badge/Github-000000?style=flat-square&logo=Github&logoColor=white&style=flat"/></a>
<img src="https://img.shields.io/badge/Swagger-85EA2D?style=flat-square&logo=Swagger&logoColor=white&style=flat"/></a>

<br/>

### 🍏 코드 컨벤션
- **Google Java Style Guide**를 기반으로 코드를 작성했습니다.
